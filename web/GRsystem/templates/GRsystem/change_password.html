{% extends "GRsystem/index.html" %}
{% load static %}
{% block content %}

<style>
    :root {
        --primary-color: #667eea;
        --secondary-color: #764ba2;
        --success-color: #4CAF50;
        --warning-color: #FF9800;
        --danger-color: #f44336;
        --info-color: #2196F3;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
        --gradient-primary: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.2);
        --border-radius: 12px;
        --transition: all 0.3s ease;
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: 'Inter', sans-serif;
    }

    .password-container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        margin: 20px;
        padding: 30px;
        min-height: calc(100vh - 40px);
    }

    .password-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e9ecef;
    }

    .password-title {
        font-size: 2.5rem;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }

    .password-subtitle {
        color: #6c757d;
        font-size: 1.1rem;
        margin-bottom: 0;
    }

    .form-section {
        background: white;
        border-radius: var(--border-radius);
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--dark-color);
        display: flex;
        align-items: center;
    }

    .section-title i {
        margin-right: 10px;
        color: var(--primary-color);
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
    }

    .form-label i {
        margin-right: 8px;
        color: var(--primary-color);
    }

    .form-control {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 12px 15px;
        transition: var(--transition);
        font-size: 1rem;
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        outline: none;
    }

    .btn-submit {
        background: var(--gradient-primary);
        border: none;
        color: white;
        padding: 15px 40px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1.1rem;
        transition: var(--transition);
        display: flex;
        align-items: center;
        margin: 0 auto;
    }

    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
        color: white;
    }

    .btn-submit i {
        margin-right: 10px;
    }

    .alert {
        border-radius: 8px;
        border: none;
        padding: 15px 20px;
        margin-bottom: 20px;
    }

    .alert-success {
        background: rgba(76, 175, 80, 0.1);
        color: var(--success-color);
        border-left: 4px solid var(--success-color);
    }

    .alert-danger {
        background: rgba(244, 67, 54, 0.1);
        color: var(--danger-color);
        border-left: 4px solid var(--danger-color);
    }

    .back-btn {
        background: #6c757d;
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        margin-bottom: 20px;
    }

    .back-btn:hover {
        background: #5a6268;
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
    }

    .back-btn i {
        margin-right: 8px;
    }

    .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
    }

    @media (max-width: 768px) {
        .password-container {
            margin: 10px;
            padding: 20px;
        }
        
        .password-title {
            font-size: 2rem;
        }
        
        .form-section {
            padding: 20px;
        }
    }

    .fade-in {
        animation: fadeIn 0.6s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<div class="password-container fade-in">
    <!-- Header -->
    <div class="password-header">
        <h1 class="password-title">
            <i class="fas fa-key me-3"></i>Change Password
        </h1>
        <p class="password-subtitle">Update your account password</p>
    </div>

    <!-- Back Button -->
    <a href="/dashboard/" class="back-btn">
        <i class="fas fa-arrow-left"></i>Back to Dashboard
    </a>

    <!-- Password Form -->
    <div class="form-section">
        <h3 class="section-title">
            <i class="fas fa-lock"></i>Password Change Form
        </h3>

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" id="passwordForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label class="form-label" for="id_old_password">
                    <i class="fas fa-lock"></i>Current Password
                </label>
                <input type="password" name="old_password" class="form-control" id="id_old_password" 
                       placeholder="Enter your current password" required>
                <div class="help-text">Enter your current password to verify your identity</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="id_new_password1">
                    <i class="fas fa-key"></i>New Password
                </label>
                <input type="password" name="new_password1" class="form-control" id="id_new_password1" 
                       placeholder="Enter your new password" required>
                <div class="help-text">Your password must contain at least 8 characters</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="id_new_password2">
                    <i class="fas fa-check-circle"></i>Confirm New Password
                </label>
                <input type="password" name="new_password2" class="form-control" id="id_new_password2" 
                       placeholder="Confirm your new password" required>
                <div class="help-text">Re-enter your new password to confirm</div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-submit">
                    <i class="fas fa-save"></i>Change Password
                </button>
            </div>
        </form>
    </div>

    <!-- Security Tips -->
    <div class="form-section">
        <h3 class="section-title">
            <i class="fas fa-shield-alt"></i>Password Security Tips
        </h3>
        <div class="row">
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-user-secret text-primary" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <h5>Strong Password</h5>
                    <p class="text-muted">Use a combination of letters, numbers, and symbols</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-history text-success" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <h5>Regular Updates</h5>
                    <p class="text-muted">Change your password regularly for better security</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="fas fa-eye-slash text-warning" style="font-size: 2rem; margin-bottom: 10px;"></i>
                    <h5>Keep Private</h5>
                    <p class="text-muted">Never share your password with anyone</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);

    // Form validation
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        const oldPassword = document.getElementById('id_old_password').value.trim();
        const newPassword1 = document.getElementById('id_new_password1').value.trim();
        const newPassword2 = document.getElementById('id_new_password2').value.trim();

        if (!oldPassword || !newPassword1 || !newPassword2) {
            e.preventDefault();
            alert('Please fill in all password fields.');
            return false;
        }

        if (newPassword1.length < 8) {
            e.preventDefault();
            alert('New password must be at least 8 characters long.');
            return false;
        }

        if (newPassword1 !== newPassword2) {
            e.preventDefault();
            alert('New passwords do not match.');
            return false;
        }

        if (oldPassword === newPassword1) {
            e.preventDefault();
            alert('New password must be different from current password.');
            return false;
        }
    });

    // Password strength indicator
    const newPasswordField = document.getElementById('id_new_password1');
    const confirmPasswordField = document.getElementById('id_new_password2');
    
    newPasswordField.addEventListener('input', function() {
        const password = this.value;
        const strength = getPasswordStrength(password);
        const helpText = this.nextElementSibling;
        
        if (password.length > 0) {
            helpText.innerHTML = `Password strength: ${strength.text} <span style="color: ${strength.color};">${strength.icon}</span>`;
        } else {
            helpText.textContent = 'Your password must contain at least 8 characters';
        }
    });

    confirmPasswordField.addEventListener('input', function() {
        const password1 = document.getElementById('id_new_password1').value;
        const password2 = this.value;
        const helpText = this.nextElementSibling;
        
        if (password2.length > 0) {
            if (password1 === password2) {
                helpText.innerHTML = '<i class="fas fa-check text-success"></i> Passwords match';
            } else {
                helpText.innerHTML = '<i class="fas fa-times text-danger"></i> Passwords do not match';
            }
        } else {
            helpText.textContent = 'Re-enter your new password to confirm';
        }
    });

    function getPasswordStrength(password) {
        let score = 0;
        if (password.length >= 8) score++;
        if (/[a-z]/.test(password)) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;

        if (score < 2) return { text: 'Weak', color: '#f44336', icon: '⚠️' };
        if (score < 4) return { text: 'Medium', color: '#ff9800', icon: '⚡' };
        return { text: 'Strong', color: '#4caf50', icon: '✅' };
    }
</script>

{% endblock content %}
